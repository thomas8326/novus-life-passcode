<div class="flex flex-col gap-4 pb-8">
  @for (record of requestRecords | sortBy: "created" : false; track $index) {
    <form
      #f="ngForm"
      novalidate
      class="border border-gray-200 rounded shadow-sm flex overflow-hidden"
    >
      <div class="min-w-[500px] w-full max-w-[600px] border-r">
        <app-request-record-card [record]="record"></app-request-record-card>
      </div>
      <div class="flex-1 relative my-2 mx-4 space-y-2.5">
        <div class="flex items-center justify-center">
          <mat-button-toggle-group
            name="status"
            aria-label="表單狀態"
            [(ngModel)]="record.status"
          >
            <mat-button-toggle [value]="RecordStatus.Init"
              >尚未確認</mat-button-toggle
            >
            <mat-button-toggle [value]="RecordStatus.Pending"
              >正在查核</mat-button-toggle
            >
            <mat-button-toggle [value]="RecordStatus.Confirmed"
              >已經確認</mat-button-toggle
            >
            <mat-button-toggle [value]="RecordStatus.Rejected"
              >拒絕需求</mat-button-toggle
            >
          </mat-button-toggle-group>
        </div>

        <mat-form-field class="w-full">
          <mat-label>狀態欄位備註</mat-label>
          <textarea
            name="statusReason"
            matInput
            rows="3"
            [required]="record.status === RecordStatus.Rejected"
            [(ngModel)]="record.statusReason"
            #statusReasonModel="ngModel"
          ></textarea>
          @if (statusReasonModel.errors?.["required"]) {
            <mat-error>請填寫原因</mat-error>
          }
        </mat-form-field>
        <div class="absolute bottom-0 right-0">
          <button
            mat-raised-button
            (click)="onSave(f, record.id)"
            class="self-end"
          >
            儲存
          </button>
        </div>
      </div>
    </form>
  }
</div>
